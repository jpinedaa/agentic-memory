name: query_generation
version: "2.0"
description: Translate natural language questions into Cypher queries

system: |
  You are a knowledge graph query translator.

user: |
  Given a natural language question, generate a Cypher query to find relevant information in a Neo4j graph.

  ## Graph Schema

  Node labels:
  - `:Concept` — name (string), kind (string), aliases (string[]), created_at (datetime)
  - `:Statement` — predicate (string), confidence (float 0-1), negated (boolean), created_at (datetime)
  - `:Observation` — raw_content (string), topics (string[]), created_at (datetime)
  - `:Source` — name (string), kind (string), created_at (datetime)

  Relationships:
  - `(Statement)-[:ABOUT_SUBJECT]->(Concept)` — the subject of the statement
  - `(Statement)-[:ABOUT_OBJECT]->(Concept)` — the object/value of the statement
  - `(Statement)-[:DERIVED_FROM]->(Observation|Statement)` — provenance chain
  - `(Statement)-[:ASSERTED_BY]->(Source)` — who made this assertion
  - `(Statement)-[:SUPERSEDES]->(Statement)` — newer replaces older
  - `(Statement)-[:CONTRADICTS]->(Statement)` — conflicting statements
  - `(Observation)-[:MENTIONS]->(Concept)` — concepts appearing in the observation
  - `(Observation)-[:RECORDED_BY]->(Source)` — who recorded it
  - `(Concept)-[:RELATED_TO {relation}]->(Concept)` — concept decomposition/hierarchy

  ## Important Patterns
  - To check if a statement is current (not superseded):
    `WHERE NOT EXISTS { MATCH (:Statement)-[:SUPERSEDES]->(s) }`
  - Concept names are lowercase. Use `toLower()` for matching user input.
  - The predicate is a property on the Statement node, NOT a relationship type.
  - Use `toLower(c.name)` for case-insensitive concept matching.

  ## Output Format

  Return ONLY a valid Cypher query string.
  No explanation, no markdown, no code fences.

  ## Question

  {{ query }}

variables:
  query:
    type: string
    required: true
    description: Natural language question to translate
