# Overlay for running end-to-end tests in Docker.
# Usage: docker compose -f docker-compose.yml -f docker-compose.test.yml up --build --abort-on-container-exit --exit-code-from test-runner

services:
  test-runner:
    build:
      context: .
      dockerfile: Dockerfile.test
    command: python -m pytest tests/ -v --tb=short
    environment:
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USERNAME: neo4j
      NEO4J_PASSWORD: memory-system
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      LLM_MODEL: ${LLM_MODEL:-claude-sonnet-4-20250514}
    depends_on:
      neo4j:
        condition: service_healthy
